var api_key = 'keyxVJaCXJ2Qz9HB5';
var base_id = 'apprv6mITjncUz0ci';
var table_name = 'texts';

  function write_to_table(text,label) {
  		apicall = "https://api.airtable.com/v0/"+base_id+"/"+table_name+"/";
  		axios.post(
  		 	apicall,
  			{"fields":{"text":text,"label":label}},
        {headers: { Authorization: "Bearer "+ api_key}}
      ).then(function(response){
        console.log("Wrote to AirTable")
      }).catch(function(error){
      	console.log(error)
      	alert("There was a problem writing to your Airtable ("+error+"). Check your credenials et al.");
      })
  }


  /*-----------------------------------------------------------------

       FUNCTIONS FROM https://github.com/turbomaze/word2vecjson

  -----------------------------------------------------------------*/

  function getCosSim(f1, f2) {
    return Math.abs(f1.reduce(function(sum, a, idx) {
      return sum + a*f2[idx];
    }, 0)/(mag(f1)*mag(f2))); //magnitude is 1 for all feature vectors
  }

  function mag(a) {
    return Math.sqrt(a.reduce(function(sum, val) {
      return sum + val*val;
    }, 0));
  }

  function norm(a) {
    var a_mag = mag(a);
    return a.map(function(val) {
      return val/a_mag;
    });
  }

  /*-----------------------------------------------------------------

       NEW FUNCTIONS

  -----------------------------------------------------------------*/
  var QVecs;
  var QLabels;

  function vectorize(string){
    // get a list of words
    words = string.replace(/[^a-zA-Z\s]+/g,'').replace(/\s{2,}/g,' ').toLowerCase().trim().split(" ");
    var vector = [];
    var usable_words = 0;
    var found = []
    var notfound = []
    // get the vector for each word
    for (i = 0, len = words.length, text = ""; i < len; i++) {
      // only do this if the word is in our list
      if (wordVecs.hasOwnProperty(words[i])) {
        found.push(words[i]);
        //console.log(wordVecs[words[i]]);
        if (usable_words==0) {
          vector = wordVecs[words[i]]
        } else {
          // average the word vectors
          for (j = 0; j < 300; j++) {
            vector[j] = vector[j] + wordVecs[words[i]][j];
          }
        }
        usable_words += 1
      } else {
        notfound.push(words[i]);
      }
    }

    for (j = 0; j < 300; j++) {
      vector[j] = vector[j]/usable_words;
    }
    // return a best-guess vector for the string
    return norm(vector);
  }


  function getNClosestAnswer(n, vec) {
    var sims = [];
    for (var ans in QVecs) {
      var sim = getCosSim(vec, QVecs[ans]);
      sims.push([ans, sim]);
    }
    sims.sort(function(a, b) {
      return b[1] - a[1];
    });
    return sims.slice(0, n);
  }


var QVecs = {" https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt#0":[0.08018978276072324,0.04412611879000691,0.035124351968197666,0.10479036732240751,-0.08299517745773548,0.00018522550956889572,0.03353996640284011,-0.07875010462471638,0.04748590372746495,-0.004921660458249931,0.019899200968112648,-0.06427357339247232,-0.027346809998695362,-0.01587858543661974,-0.13299931202796783,0.08191212274206179,0.046371656521464556,0.09413411222502197,0.05779035898549571,-0.11965439289324624,-0.08349425730296278,0.06858135277821006,0.061974654698187526,0.016912761198379415,0.01256028329557557,0.016869670541639434,-0.021110884509875846,-0.014003498724299885,0.010973003581631,0.024311812847113336,-0.08236682564228821,0.12427248932192496,-0.020544274530951548,-0.08951215693156059,0.01705103718642564,0.016113011472167885,0.08485418556679415,0.010725714663473917,0.021883300610543357,0.07756639785262766,0.14355491506893836,-0.01956573073647559,0.14137562118291683,0.037137714668563755,0.027303397769890148,0.030666720000065647,-0.0361093272039781,-0.037133212659650625,0.0032308345393033044,0.03103877887952957,0.014464311493765565,0.07330010126330377,0.009832709038347478,-0.061004793349472605,0.015911707359337793,0.008049591936681628,-0.04775184382540502,-0.02889292848829129,0.029632865810371202,-0.019793403758654023,0.01624614230717052,0.006886787348832443,-0.09474767172546894,-0.05265002952289361,-0.0012255111405678198,-0.04855255826781221,-0.0803068349924647,0.08534008095734728,-0.034352579011660604,0.03167902886139011,0.03654473578029111,0.0653173963161887,0.08432134065471836,-0.05476693842826175,-0.1577130899566109,-0.1196724009288988,0.008095898314073853,0.06713556477296394,0.000534774344467141,0.0526297704827845,-0.01886598992254864,0.0042913792104113295,0.07531282081953942,-0.024707668059403803,-0.0031880654546285435,-0.04539536373144515,-0.03992606604611914,0.08953241597166968,0.0141781123557164,0.065175583035425,-0.0031189274606054315,0.08882302799578602,-0.08079369509921348,-0.04818017781628308,-0.012549671417423188,-0.08375022866688092,0.04758912836040178,0.0380998582877133,-0.013453288920702007,0.01404626780897465,-0.0773856743519719,-0.01594064884520793,-0.02164469413814732,0.04918187479945517,-0.035015660610152044,0.005810164074463237,-0.08305788401045412,-0.013386401931135456,0.030499824098214508,-0.012808536929928324,-0.019234189937229876,-0.0764688723940189,-0.030523942003106295,-0.04834160699302543,0.07821918914503193,-0.054673039385216414,0.03558001958461977,-0.09545223612037423,0.03301676865272103,-0.023566408799924624,-0.06418353321420965,0.007896202061569886,-0.022164997739679393,0.0942051796514364,0.019020666085921283,0.020625632263453167,-0.13714694852522413,-0.013559086130160627,-0.009190851196160818,-0.01474311447431458,-0.11692649706395294,-0.09904934124196742,-0.06676607847002182,-0.026485961580091304,-0.01094309737956519,-0.09668964542735532,0.044299446133162536,0.046877167807996334,0.004258578859758502,0.06854533670690499,0.060983248021102616,-0.05313399548105539,-0.014485535250070335,-0.023858396235147815,0.05743662971374955,0.005390190957280977,-0.007041785084270305,-0.137304840409249,-0.004397819564000395,-0.035958188333322934,0.036230238300502246,0.08391487356427547,-0.12750525329361956,0.007716121705044568,0.04566001754112433,0.01870070188102363,-0.01546375747248107,-0.10591361854623418,-0.07256177180154999,0.03799952780336347,0.03107511652289986,0.07530703252236538,-0.018151778365686638,0.02549809219572385,-0.007059149975792387,-0.08066442312899352,0.009467724744318493,-0.03924626270023607,0.06548204121358328,-0.06467167960921935,-0.13647647076923256,-0.0075955321805856535,-0.05313817591790332,-0.04223591819062154,-0.012658684347534047,0.020757155238129682,0.09876249895978782,-0.034226201190027665,0.011454718535336219,0.01367163635298895,-0.10708896444462711,0.005037426401730497,0.05387296808693963,-0.012936522611887394,-0.000562429542076389,-0.019118102421684092,-0.06322621317603846,0.020163533205726593,0.036474633070072315,0.0018754082843850785,0.06325837038256085,0.010134986779657833,-0.002861991380491631,-0.048287582886067826,0.007778828257763209,0.045208530361550155,0.009834316898673598,-0.013571627440704353,0.022211947261202063,-0.09092675244647998,0.009169627439856049,0.03944049222763123,-0.05838880459887716,0.056872592311347066,0.033600743523167415,0.01244451735209501,-0.1099532068295753,-0.10145566500603695,0.025126033316259944,-0.014750510631814725,0.00609668478457762,0.0765026374608674,-0.023560942074815815,0.017286427938169445,-0.10210717001018033,-0.04211211294551038,0.1160820488206753,0.006650431880892969,-0.022024792319241822,-0.061478147429482016,-0.053400257151060684,0.03440338739796596,-0.08723671299803712,-0.025175233842239186,0.04469305034099644,-0.09193809659160877,0.06059318110598617,0.0014634744688334165,-0.03127545591953427,-0.006131092995556563,0.06440348850682272,-0.02198073694630617,-0.01948662400843054,0.034640064437970665,0.03778150194314176,-0.013556513553638839,-0.06561870934130337,-0.00137439900676643,0.07849445483286346,-0.03720910366704343,-0.017179344440449926,0.03716987187508613,-0.022645104833058493,-0.1038783889454329,-0.11782239683766638,-0.05069744394285483,-0.02919810037818866,0.05045240602915431,0.011197782455222422,-0.049712468707074395,0.06135016174752294,-0.002991263350711591,0.09518822545482553,0.04679709636375561,0.040016106224381794,-0.029779181100048027,0.06847330456429486,-0.017242050993168563,-0.09063283557886546,-0.07418571073093007,-0.01451126101528824,-0.024015001830911792,-0.045897980869389926,0.007169770766229368,0.04083740127896333,0.07043296472976858,0.05347743444671439,-0.027767747832073288,-0.06074206897218477,0.02497296501321343,0.04261955366443351,0.098532896505218,0.11631969057687568,0.11030339880860399,0.02019150997540107,-0.06481381446204827,-0.018911974727875647,-0.09103801638104742,-0.05008645701892965,-0.02470734648733859,0.07513981504844902,0.002933380378971306,0.029799118568091896,0.10284935833671682,0.01782699057981062,-0.02182188034608562,-0.04844965520694061,-0.07367344643102858,0.0016724963112288746,0.08074481614529948,-0.05807366397495786,0.09095794493680671,-0.1393619369104855,-0.009780935935846452,-0.05347936387910574,-0.03166102082573758,0.04238384134062447,-0.012120694282414666,0.016122015489994146,-0.06407934386507715]," https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt#1":[0.011489419235378617,0.10329164075268801,0.041396874064759524,0.10277686378727431,-0.0406416290687171,-0.029194202196160136,0.0161083938853365,-0.07966019156090247,0.014481375086421564,0.043101763995318725,0.04595514504905022,-0.05674946717278095,0.0025812334905623126,-0.06111945181259633,-0.10049704900690687,0.13737332170696567,0.04395291213762885,0.04607618185953616,0.09571615674618664,-0.08244255611868558,-0.06169196827688981,0.1029321737762397,0.06442332446453954,-0.003158443218935866,-0.01923225515841924,-0.008120890695384995,-0.054141988455455106,0.005263742679694512,0.021621929370345117,0.051706987193071735,0.04280269191716391,0.10091987504843611,0.0003883058491508387,-0.06792715486768351,0.03982568040700749,0.05192615027491593,0.022086933035120212,0.05905694750983092,0.04936517192406759,0.07460560790014466,0.04877727884456441,0.00017173641324562283,0.09595773633936064,0.04254153647249805,0.02925083013249463,0.036218412933677814,0.00419429600418652,0.021461246829077556,-0.01597982315093255,0.031084970085679908,-0.054677761602279634,0.052427959010634705,0.018665728781175315,-0.035182066120629255,0.020112550940805562,0.04831974735023258,-0.011085983784917037,-0.050738445695285204,0.016753717696345764,-0.03302186782082877,0.00226363536998618,0.02362632365338231,-0.13735819210565495,-0.04537318030312187,0.0156315953068865,-0.03677789941480163,-0.037730879036954254,0.13481580155070264,-0.009588894296850283,0.011487875398510174,0.06269546224137787,0.058171711449465584,0.06767229827744092,0.04477281302172166,-0.15305592538398557,-0.03766517333983331,0.06371112164038932,0.010039447648536747,0.0816598925798596,0.08832161042066682,-0.006100811029764418,-0.014710912752021703,-0.018036213859698908,-0.014620073390682501,-0.017505813265176563,-0.0872951441635763,-0.08477047685587373,0.1309890622281551,0.10184660944382518,0.05475452117137864,-0.062223356927007964,-0.0008256439572434384,-0.009415922814109905,-0.10781705888841826,-0.07279567530905656,-0.04861171777879256,0.05172866266270468,0.01484584409432364,-0.06869555335384508,-0.02052469363120516,-0.048824334992314575,-0.046816606021641526,-0.021065901083806616,-0.0025169481233603378,-0.02652984852860084,-0.022080695934171706,-0.02658993465952065,-0.008605223197753002,-0.006801774721512372,-0.08922673109989769,-0.0151492389157101,-0.061576674539554455,-0.0256521463921535,0.012276652531335176,0.0977758203891141,-0.009332370362789761,0.004900076466964034,-0.0585314871932876,0.09437956453896323,0.008894970501222425,-0.06490617488351383,-0.005795254836762137,0.032205548638270735,0.09461601859373402,0.01382221849707105,0.06826661371831681,-0.09804901776135382,-0.04239993575492444,0.03681952125677486,-0.03109639447850639,-0.08032422667475729,-0.11594807715366023,-0.0878952026776028,-0.01171704254326188,-0.0011936946666802949,-0.1248663287148588,0.014577463493113474,0.12088150049698264,-0.014807680446935721,0.084026841513082,0.01781346907631992,-0.08941050944071717,0.048311842905466154,-0.030263710625142867,0.029949941220000463,-0.028589573925003036,-0.009753220293127378,-0.10598100457751611,-0.008352836746499906,-0.0027946534992559077,0.11521753354751291,0.02396139800730924,-0.04644454133634671,-0.007314699082683952,0.008130771251343035,-0.023989742852213846,0.05546091916890351,-0.0751389726614544,-0.06833744495384099,0.034892442324109305,0.003238660982620177,0.033857207073606024,-0.00007700658299794872,0.07486787490735577,0.0023801641768162757,-0.06494977283667869,0.03564021514970846,-0.026483286408648596,0.0045315317297292676,-0.04711394900250369,-0.1712809196159577,-0.025556675520208978,-0.023933485436727787,-0.0833030907891558,0.009673064282917808,0.012917838859537012,0.10733704912928188,-0.0034547363907274893,-0.028837884646923446,0.004829121724490371,-0.07105027509906942,0.0074131958748906305,0.04084807093476533,0.089998958301493,0.011227769762914858,0.0027960738291748738,-0.018327566753511514,-0.049879640122107605,0.10890725473143813,0.0056987341557470685,0.04667642563398689,-0.006784730762484765,-0.012752092533340953,-0.011277172542705044,-0.014285431311078753,0.009693504683055992,-0.012178896780825354,-0.010859904313902208,-0.05352247759688621,-0.11597160522753532,-0.03035893448318843,0.06797044405347466,-0.08504737943659771,0.055595912264680185,-0.09494078011737972,-0.00032334119372674736,-0.09153804015238139,-0.019205268889958847,0.03463351000453401,0.00652518090816209,0.025593665851576877,0.09787783712938082,-0.027409773790138734,0.030462433306848866,-0.11137115661999873,0.020443673072349258,0.07650841771723828,0.016962197427060337,-0.06895430041299616,-0.058396247083611956,-0.03437661554962505,-0.006842285000940327,-0.0060238662002412065,0.011833015568819336,0.06328823384538536,-0.14546074201904283,0.07013792926329421,-0.012328710710539084,-0.025239756687854963,-0.009931564328169933,0.026202431605541403,-0.03684885415727529,0.03222308662509625,0.008437747774264285,0.07258966571733151,-0.00280867153802137,-0.023051707570947755,0.006642574263638512,0.09048217924131571,-0.05592147658349749,0.007885733463583731,0.027515063464566558,-0.009386836927508432,-0.1026412531567503,-0.028838255167771876,-0.05506372081939045,-0.04132653685703324,0.007489955443989616,-0.025906076680275038,-0.06662255096037427,0.08453229370381031,0.01744492433908516,0.028279942002668066,0.04971191768471994,0.02183504061166502,-0.04065385625671517,-0.02259510237873699,-0.03383954557983103,-0.0952539937412495,-0.06219173914794224,-0.003722252443291323,-0.027396929067393286,-0.07879033211574682,-0.0006369253384449358,0.0366894684389772,0.1298043835687865,0.06358693540269174,0.026654652301045786,-0.07466433545462023,-0.008004855916352803,0.029940554691840326,0.10765421497553486,0.0839805264070287,0.10314207383687325,0.02239242747464776,-0.06372019940117576,0.007088310844295438,-0.1547605683006458,-0.04655470953527883,-0.08791922477927577,0.030775091149445988,-0.025046159544552176,-0.000733199005561049,0.10135863348644765,0.0323604881063877,-0.029361924633547806,-0.0658310566746608,-0.05209547830264678,0.002732344243245538,0.04444267894577377,-0.03458985029789443,0.044258962358429035,-0.11992722405186053,-0.015514387211834287,-0.016441615635021285,-0.04733663203240794,0.004293533838090051,0.0204100174286172,0.013097603224498544,-0.0743613111540822],"undefined#2":[0.33391635510352025,0.3054878537595607,0.0255911186365547,0.10944655834116267,-0.04173262777780836,0.0014843186132647726,0.04224933208177001,-0.036270584216915654,0.015927441429784715,0.008619358562095919,-0.04249940386902532,-0.07462673220451477,-0.017752920614830057,-0.012996144591504444,-0.09885362853786409,0.11605543480281258,0.05896944542928507,0.05671358772538196,0.06438488986557833,-0.07601028331298719,-0.0659218591898817,0.03938002105159066,0.07980032317519961,0.002046600717300637,0.005498486710774021,-0.004027120783310442,-0.03019984078407906,-0.014441547876831511,-0.008853423235063388,-0.007691594999454548,0.007677134189588072,0.08152477713804906,0.000005898865014839226,-0.07080034464331122,0.011481921214337582,0.026353532622089174,0.04598168142594086,0.043588546251740946,0.029875565474776232,0.06870736433845864,0.07174996645981019,0.014187257160229023,0.1218327908344176,-0.002446282229867585,-0.005763410656545656,0.031210436629242725,-0.016594709967960093,-0.03857389055834103,-0.008963010402110913,-0.013265841081786467,-0.03397316719541609,0.07898568800763245,0.003270548392256685,-0.019095313299444912,0.004795080465565987,0.028133023568232413,-0.031943785818708936,-0.018016632334296054,0.021336232939030503,-0.027702492327950322,0.04571673838999118,0.025315017391539737,-0.09427339848106674,-0.03868984429976543,0.03662869686679712,-0.03567152488488275,-0.08085894990831581,0.09160134626059076,-0.019518055747086056,-0.010731085421785311,0.08751905486274023,0.062006511399004545,0.04197592255185891,0.01652555579800457,-0.1919956380722092,-0.07811670310318103,0.02078491814227951,0.027919700373707095,0.05240581268959364,0.07298365012556741,-0.03774245603409734,-0.025386500563216327,0.03293668506882808,0.0118482330956879,-0.05578731319662782,-0.05831836536208892,-0.03789575970886001,0.10315779553000255,0.022896998170262674,0.031950782368961164,-0.009056180016042708,0.04465020832316577,-0.03837541952233205,-0.05792186236416588,-0.019270876121804045,-0.0716250116994392,0.08093389794730697,0.04088615019326791,-0.018618517012679116,-0.014668367827232211,-0.09851661053471854,-0.015385070381446188,-0.01348806029927915,0.023751064100574634,-0.03854029184498791,-0.03125188140577093,-0.06374689611542966,-0.02951005538090367,0.03137381037292233,-0.0545490001626955,-0.08899361839502576,-0.064642941347255,-0.029879622137610064,0.0608945276182622,0.053991652869683375,-0.03668304660368143,0.04591034143059958,-0.06156472649876696,0.037434960991293044,-0.020883604817665314,-0.03934116299418708,0.019852782928866622,-0.016613628334399267,0.09838788546418434,-0.022200073040499743,-0.022987533339624725,-0.07609391738298724,-0.01105426304585074,0.0028851367877757955,-0.0351464209025828,-0.10228158499316238,-0.10845994930470823,-0.07166294388320776,0.0010942585504307666,-0.015247516103567787,-0.09973246397418496,0.020161413837264393,0.09308366040516117,0.016950388620141265,0.041761119868535375,0.011012369650138555,-0.039722002501027025,0.0523397702186589,-0.03502516009166287,0.048010289650437334,0.017111834255838666,-0.034311521511024554,-0.11741017883262031,0.007025748679543265,-0.023899996124565802,0.06758186471166289,0.07265050742856431,-0.06508620573629083,0.0016693406188434906,0.0011187321586800356,0.03543293583971943,-0.0113974853568598,-0.06398881639666124,-0.05065699965956316,0.038421445941590235,0.042428636579025285,0.0502988392842366,-0.05830385682677734,0.06365998807989551,0.02897825074611114,-0.10876551623953033,0.0239857301141504,-0.028346671295784442,0.07743091709230536,-0.04198594489533073,-0.12296502929406203,0.003679918170179719,-0.01961167398020183,-0.04117247422862413,-0.020515927988585026,0.022709141273244776,0.11054486400933826,0.0006495051275077141,-0.01468219866122332,-0.0029380738514850208,-0.08120204813316761,0.016287596728716627,0.056258850139343175,0.03703075510653025,0.001801024666974115,0.0022018420451345357,-0.030696968110459105,-0.017903933468227752,0.03954903594288155,0.045270658199694246,0.020511164989163663,0.034448149915267935,0.007134381337688715,0.009572712508401991,0.03409543978577223,-0.003645737206396323,0.012580350968670427,-0.018791884464563466,-0.04487816413915994,-0.0961578663162605,-0.016837298405423112,0.07481883666614689,-0.04138624604233342,0.039325556773638116,-0.053000214018184416,0.048760266384977734,-0.06887825961228661,-0.058095124820071016,0.005242115164765004,-0.01099646753182994,0.013228338427023839,0.07498876788598377,-0.022255405921553176,0.01382626189346328,-0.1020366198285332,-0.03892188541386049,0.0970657570035606,-0.01292141608956079,-0.05338478565483147,-0.05071367839816853,-0.049565595090749606,-0.03068707939823358,-0.060437756928262,-0.006232971765833704,0.062364681319420134,-0.10599341239593857,0.09057881905415109,-0.00015715034563805447,-0.06415128335688387,0.0068335583121099455,0.03229644822275954,-0.018247623488598833,-0.008424667381339153,0.030960317116542315,0.06436936000574153,-0.0014864758033834677,-0.03263729380660243,-0.0026680814634433524,0.07605484933362519,-0.05671825527391312,-0.020573418059757157,0.024171630267919034,0.021648595977235393,-0.06394763888262563,-0.0567156780998775,-0.02648141772478953,-0.026486552982682703,0.0408877060427783,-0.02152329759365967,-0.042615166708669286,0.05501547820822984,-0.002802695853903355,0.055981364856420204,0.07532379096552398,0.026838155881852004,-0.01782063347634344,-0.01619163994879077,-0.010469607253150178,-0.0639855806114832,-0.06998857300245032,-0.04296441197085046,-0.02241034180653841,-0.04202869734905478,0.0145167059077811,0.037796624414290235,0.07863814177129701,0.007387612549409899,0.021950841221078266,-0.059051752731911204,0.02955879260544375,0.05628042204053012,0.08736667706161255,0.13131161784721124,0.11091415395846303,-0.005731635055195493,-0.03892819471770322,-0.01453722784917577,-0.10683296024584993,-0.02575837723146576,-0.07709504449984228,0.006009053522495323,-0.03384786881184037,0.024025914938927875,0.05683339768277074,0.044129685983595804,-0.005429532987687937,0.00014050371038582088,-0.07538638765932222,-0.027903674169241215,0.021278666507146205,-0.021947194997072324,0.06301051158765487,-0.08483610215060251,0.029852733621838545,-0.06877815071863672,-0.013086431588551965,0.03511587661771631,-0.016365074216298268,0.013394957500970504,-0.048281866523256445]}
var QLabels = {" https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt#0":" https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt"," https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt#1":" https://www.qnamarkup.net/i/?source=https://suffolklitlab.org/clio/qnas/Closing_transfer.txt"}
